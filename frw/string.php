<?php
/**
* @version		$Id: string.php v5.1 2008-09-09 10:29 phu $
* @package		vFramework
* @copyright	Copyright (C) 2008 Vipcom. All rights reserved.
* @license		GPL
*/
defined('V_LIFE')or die('v');setlocale(LC_CTYPE,'C');if(!extension_loaded('xml')){require_once(V_PATH_LIB.DS.'utf8'.DS.'xml.php');}if(extension_loaded('mbstring')){if(ini_get('mbstring.func_overload')& MB_OVERLOAD_STRING){trigger_error('String functions are overloaded by mbstring',E_USER_ERROR);}mb_internal_encoding('UTF-8');mb_http_output('UTF-8');mb_http_input('UTF-8');mb_language('uni');mb_regex_encoding('UTF-8');require_once(PATH_CORE.DS.'utf8'.DS.'mbstring.php');}else{require_once(PATH_CORE.DS.'utf8'.DS.'native.php');}if(function_exists('iconv')&&PHP_VERSION_ID<50600){iconv_set_encoding('input_encoding','UTF-8');iconv_set_encoding('output_encoding','UTF-8');iconv_set_encoding('internal_encoding','UTF-8');}else{ini_set('default_charset','UTF-8');}function utf8_substr_replace($str,$repl,$start,$length=NULL){preg_match_all('/./us',$str,$ar);preg_match_all('/./us',$repl,$rar);if($length===NULL){$length=utf8_strlen($str);}array_splice($ar[0],$start,$length,$rar[0]);return join('',$ar[0]);}function utf8_compare($str1,$str2,$caseInsensitive=true){$letters1=utf8_split($str1);$letters2=utf8_split($str2);$n1=count($letters1);$n2=count($letters2);for($i=0,$n=min(Array($n1,$n2));$i<$n;$i++){$result=utf8_compare_char($letters1[$i],$letters2[$i],$caseInsensitive);if($result!=0){return $result;}}return $n1<$n2?-1:($n1>$n2?1:0);}function utf8_compare_char($letter1,$letter2,$caseInsensitive=true){global $UTF8_ABC_UPPER,$UTF8_ABC_LOWER;$isLower1=true;$pos1=array_search($letter1,$UTF8_ABC_LOWER);if($pos1===false){$isLower1=false;$pos1=array_search($letter1,$UTF8_ABC_UPPER);}$isLower2=true;$pos2=array_search($letter2,$UTF8_ABC_LOWER);if($pos2===false){$isLower2=false;$pos2=array_search($letter2,$UTF8_ABC_UPPER);}if($pos1===false||$pos2===false){if($caseInsensitive){$letter1=strtolower($letter1);$letter2=strtolower($letter2);}return $letter1<$letter2?-1:($letter1>$letter2?1:0);}if(!$caseInsensitive){if($isLower1){$pos1+=count($UTF8_ABC_LOWER);}if($isLower2){$pos2+=count($UTF8_ABC_LOWER);}}return $pos1<$pos2?-1:($pos1>$pos2?1:0);}function utf8_split($str,$split_length=1){$len=utf8_strlen($str);$result=array();while($len){$result[]=utf8_substr($str,0,$split_length);$str=utf8_substr($str,$split_length,$len);$len--;}return $result;}function utf8_strtoascii($str){global $UTF8_TO_ASCII;return strtr(utf8_strtolower($str),$UTF8_TO_ASCII);}$GLOBALS['UTF8_ABC_LOWER']=array('a','à','ả','ã','á','ạ','ă','ằ','ẳ','ẵ','ắ','ặ','â','ầ','ẩ','ẫ','ấ','ậ','b','c','d','đ','e','è','ẻ','ẽ','é','ẹ','ê','ề','ể','ễ','ế','ệ','f','g','h','i','ì','ỉ','ĩ','í','ị','j','k','l','m','n','o','ò','ỏ','õ','ó','ọ','ô','ồ','ổ','ỗ','ố','ộ','ơ','ờ','ở','ỡ','ớ','ợ','p','q','r','s','t','u','ù','ủ','ũ','ú','ụ','ư','ừ','ử','ữ','ứ','ự','v','w','x','y','ỳ','ỷ','ỹ','ý','ỵ','z');$GLOBALS['UTF8_ABC_UPPER']=array('A','À','Ả','Ã','Á','Ạ','Ă','Ầ','Ẳ','Ẵ','Ắ','Ặ','Â','Ầ','Ẩ','Ẫ','Ấ','Ậ','B','C','D','Đ','E','È','Ẻ','Ẽ','É','Ẹ','Ê','Ề','Ể','Ễ','Ế','Ệ','F','G','H','I','Ì','Ỉ','Ĩ','Í','Ị','J','K','L','M','N','O','Ò','Ỏ','Õ','Ó','Ọ','Ô','Ồ','Ổ','Ỗ','Ố','Ộ','Ơ','Ờ','Ở','Ỡ','Ớ','Ợ','P','Q','R','S','T','U','Ù','Ủ','Ũ','Ú','Ụ','Ư','Ừ','Ử','Ữ','Ứ','Ự','V','W','Z','Y','Ỳ','Ỷ','Ỹ','Ý','Ỵ','Z');$GLOBALS['UTF8_TO_ASCII']=array('ấ'=>'a','ầ'=>'a','ẩ'=>'a','ẫ'=>'a','ậ'=>'a','ắ'=>'a','ằ'=>'a','ẳ'=>'a','ẵ'=>'a','ặ'=>'a','ạ'=>'a','ả'=>'a','ế'=>'e','ề'=>'e','ể'=>'e','ễ'=>'e','ệ'=>'e','ẻ'=>'e','ẽ'=>'e','ẹ'=>'e','ứ'=>'u','ừ'=>'u','ử'=>'u','ữ'=>'u','ự'=>'u','ố'=>'o','ồ'=>'o','ổ'=>'o','ỗ'=>'o','ộ'=>'o','ớ'=>'o','ờ'=>'o','ở'=>'o','ỡ'=>'o','ợ'=>'o','ọ'=>'o','ỏ'=>'o','ị'=>'i','ỉ'=>'i','ụ'=>'u','ủ'=>'u','ỳ'=>'y','ỷ'=>'y','ỹ'=>'y','ỵ'=>'y','â'=>'a','ă'=>'a','á'=>'a','à'=>'a','ã'=>'a','ê'=>'e','é'=>'e','è'=>'e','ý'=>'y','ư'=>'u','ú'=>'u','ù'=>'u','ũ'=>'u','í'=>'i','ì'=>'i','ĩ'=>'i','ô'=>'o','ơ'=>'o','ó'=>'o','ò'=>'o','õ'=>'o','đ'=>'d','ä'=>'a','å'=>'a','æ'=>'ae','ǽ'=>'ae','ç'=>'c','ć'=>'c','č'=>'c','ë'=>'e','ğ'=>'g','ĝ'=>'g','î'=>'i','ǐ'=>'i','ï'=>'i','ı'=>'i','ĳ'=>'ij','ñ'=>'n','ö'=>'o','ǒ'=>'o','ø'=>'o','ǿ'=>'o','ş'=>'s','ß'=>'s','ü'=>'u','ǜ'=>'u','ǘ'=>'u','ǚ'=>'u','û'=>'u','ǔ'=>'u','ǖ'=>'u','ÿ'=>'y',);