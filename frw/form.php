<?php
/**
 * @version		$Id: form.php 3 2015-02-09 11:35 phu $
 * @package		vFramework.core.form
 * @copyright	(c) 2015 Vipcom. All rights reserved.
 * @license		Commercial
 */

class vForm{static function _size(&$w,&$h,$w2,$h2){if($w&&$h)return;if($w==0&&$h==0){$w=$w2;$h=$h2;return;}if($w)$h=$h2 * $w / $w2;if($h)$w=$w2 * $h / $h2;}static function media($f,$p=array(),$r=false){$e=strtolower(substr(strrchr($f,'.'),1));$f=(substr($f,0,7)=='http://'?'':URL_UPLOAD).$f;if($r){$p['width']=(isset($p['width']))?$p['width']:0;$p['height']=(isset($p['height']))?$p['height']:0;$t=@getimagesize($f);if($p['width']||$p['height']){$p['size']='';}else $p['size']=($t)?$t[3]:'';}else{$p['size']=((isset($p['width'])&&$p['width'])?' width="'.$p['width'].'"':'').((isset($p['height'])&&$p['height'])?' height="'.$p['height'].'"':'');}$p['tip']=(isset($p['tip'])&&$p['tip'])?' title="'.$p['tip'].'" alt="'.$p['tip'].'"':'';$p['attr']=(isset($p['attr'])&&$p['attr'])?' '.$p['attr']:'';switch($e){case 'wmv':$h='<object id="mediaPlayer" classid="CLSID:22d6f312-b0f6-11d0-94ab-0080c74c7e95" codebase="http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701" standby="Loading Microsoft Windows Media Player" type="application/x-oleobject"'.$p['size'].'><param name="fileName" value="'.$f.'"><param name=wmode value="transparent"><param name="animationatStart" value="true"><param name="transparentatStart" value="false"><param name="autoStart" value="false"><param name="showtracker" value="true"><param name="showControls" value="true"><param name="loop" value="false"><param name="showstatusbar" value="true"><param name="URL" value="'.$f.'"><embed type="application/x-mplayer2" pluginspage="http://microsoft.com/windows/mediaplayer/en/download/" id="mediaPlayer" name="mediaPlayer" wmode="transparent" bgcolor="#000000" showcontrols="true" showaudiocontrols="false" showtracker="-1" showdisplay="0" showstatusbar="-1" videoborder3d="-1" enabletracker="true" src="'.$f.'" url="'.$f.'" autostart="0" loop="false"'.$p['size'].'></object>';break;case 'flv':$h='<embed type="application/x-shockwave-flash" src="'.URL_UPLOAD.'flvplayer.swf" style="" id="playlist" name="playlist" quality="high" allowscriptaccess="always" allowfullscreen="false" wmode="transparent" bgcolor="#ffffff" flashvars="file='.$f.'&image='.URL_UPLOAD.'/flv_preview.jpg"'.$p['size'].'>';break;case 'swf':$h='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" type="application/x-shockwave-flash"'.$p['size'].' codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0">
<param name="src" value="'.$f.'">
<param name="quality" value="high">
<param name="wmode" value="opaque">
<embed src="'.$f.'"'.$p['size'].' quality="high" wmode="opaque"></embed>
</object>';break;case 'jpg':case 'jpeg':case 'gif':case 'png':case 'bmp':$h='<img src="'.$f.'"'.$p['size'].$p['tip'].$p['attr'].' />';break;default:$h=$f;break;}return $h;}static function select($arr,$name,$attribs=null,$key=null,$text=null,$selected=null,$idtag=false){$h='';if(is_array($arr)){reset($arr);$id=($idtag)?$idtag:$name;$h='<span id="'.$id.'_wrp"><select name="'.$name.'" id="'.$id.'" '.$attribs.'>';if(is_string($key)AND $text){foreach($arr as $i=>$option){$element=& $arr[$i];$isArray=is_array($element);$x='';if($isArray){$k=$element[$key];$t=$element[$text];$id=(isset($element['id'])?$element['id']:null);if(isset($element['disable'])&&$element['disable']){$x.=' disabled="disabled"';}}else{$k=$element->$key;$t=$element->$text;$id=(isset($element->id)?$element->id:null);if(isset($element->disable)&&$element->disable){$x.=' disabled="disabled"';}}$splitText=explode(' - ',$t,2);$t=$splitText[0];if(isset($splitText[1])){$t.=' - '.$splitText[1];}if(is_array($selected)){foreach($selected as $val){$k2=is_object($val)?$val->$key:$val;if($k==$k2){$x=' selected="selected"';break;}}}else{$x=($k==$selected?' selected="selected"':'');}$h.='<option value="'.$k.'" '.$x.'>'.$t.'</option>';}}else{foreach($arr as $k=>$t){$x='';if($key===true)$k=$t;if(is_array($selected)){foreach($selected as $val){$k2=is_object($val)?$val->$key:$val;if($k==$k2){$x=' selected="selected"';break;}}}else{$x=($k==$selected?' selected="selected"':'');}$h.='<option value="'.$k.'" '.$x.'>'.$t.'</option>';}}$h.='</select></span>';}return $h;}static function radio($arr,$name,$newline=false,$key=null,$text=null,$selected=null,$idtag=false){$h='';if(is_array($arr)){reset($arr);$id=($idtag)?$idtag:$name;if(is_string($key)AND $text){foreach($arr as $i=>$option){$element=& $arr[$i];$isArray=is_array($element);$x='';if($isArray){$k=$element[$key];$t=$element[$text];$id=(isset($element['id'])?$element['id']:null);if(isset($element['disable'])&&$element['disable']){$x.=' disabled="disabled"';}}else{$k=$element->$key;$t=$element->$text;$id=(isset($element->id)?$element->id:null);if(isset($element->disable)&&$element->disable){$x.=' disabled="disabled"';}}$splitText=explode(' - ',$t,2);$t=$splitText[0];if(isset($splitText[1])){$t.=' - '.$splitText[1];}if(is_array($selected)){foreach($selected as $val){$k2=is_object($val)?$val->$key:$val;if($k==$k2){$x=' checked="checked"';break;}}}else{$x=($k==$selected?' checked="checked"':'');}$h.=($newline)?'<p class="'.$id.'">':' ';$h.='<input type="radio" name="'.$name.'" id="'.$id.'-'.$k.'" value="'.$k.'" '.$x.'> <label for="'.$id.'-'.$k.'">'.$t.'</label>';$h.=($newline)?'</p>':' ';}}else{foreach($arr as $k=>$t){$x='';if($key===true)$k=$t;if(is_array($selected)){foreach($selected as $val){$k2=is_object($val)?$val->$key:$val;if($k==$k2){$x=' checked="checked"';break;}}}else{$x=($k==$selected?' checked="checked"':'');}$h.=($newline)?'<p class="'.$id.'">':' ';$h.='<input type="radio" name="'.$name.'" id="'.$id.'-'.$k.'" value="'.$k.'" '.$x.'> <label for="'.$id.'-'.$k.'">'.$t.'</label>';$h.=($newline)?'</p>':' ';}}}return $h;}static function draw($p,$d=null,$l=null,$n=null,$c='',$f=''){global $tpl,$db,$map,$ctype,$cfg,$alt;$h='';$ignore='';if($p){if(!is_array($p))$p=preg_split('/[\n,;]/',$p);if(!is_array($n))$n=preg_split('/[\n,;]/',$n);foreach($p as $k=>$v){if($k&&$ignore==$k){$ignore='';continue;}if(is_int($k)){$t=preg_split('/[:=]/',$v.':');$k=$t[0];$v=$t[1];}if(empty($v))$v='string';if($k){$z=0;if($k{0}=='~'||$k{0}=='*'||$k{0}=='#'){if($k{0}=='~'||$k{0}=='#')$z=1;$k=substr($k,1);}$r=in_array($k,(array)$l);$s='';$g=0;$e=$f?$f.'['.$k.']':$k;$y=$f?$f.'_':'';switch($v){case 'bool':$s='<input type="checkbox" name="'.$e.'" id="'.$y.$k.'"'.((isset($d[$k])&&$d[$k])?' checked="checked"':'').' value="1">';break;case 'captcha':$t=vCaptcha::sid();$s='<div class="'.$y.$k.'_wrp"><input type="hidden" name="'.$e.'_sid" id="'.$y.$k.'_sid" value="'.$t.'" />
<span><img src="'.(defined('V_CP')?VAR_INDEX.'?'.VAR_PAGE.'=cp.staff&'.VAR_TASK:URL_BASE.VAR_INDEX.'?'.VAR_PAGE.'=null&'.VAR_SECTION).'=captcha&sid='.$t.'" id="'.$y.$k.'_img" style="width:'.CAPTCHA_WIDTH.'px;height:'.CAPTCHA_HEIGHT.'px" /></span>
<span>'.$tpl->_('CAPTCHA_NOTE').'</span>
<span id="'.$y.$k.'_btn"><a href="javascript:'.$y.$k.'_ref();" title="'.$tpl->_('CAPTCHA_BTN').'">'.$tpl->_('CAPTCHA_BTN').'</a></span>
<span><input type="text" name="'.$e.'" id="'.$y.$k.'" class="string captcha" /></span></div>
<script type="text/javascript">
function '.$y.$k.'_ref(){
	$.get("'.(defined('V_CP')?VAR_INDEX.'?'.VAR_PAGE.'=cp.staff&'.VAR_TASK:URL_BASE.VAR_INDEX.'?'.VAR_PAGE.'=null&'.VAR_SECTION).'=captcha", function(e) {
	  $("#'.$y.$k.'_img").attr("src", "'.(defined('V_CP')?VAR_INDEX.'?'.VAR_PAGE.'=cp.staff&'.VAR_TASK:URL_BASE.VAR_INDEX.'?'.VAR_PAGE.'=null&'.VAR_SECTION).'=captcha&sid=" + e);
	  $("#'.$y.$k.'_sid").val(e);
	  $("#'.$y.$k.'").val("");
	});
}
</script>';break;case 'category':case 'categoryr':case 'categories':$sql='SELECT prop FROM #__ctype WHERE ctype=2 AND name="category"';if(!$db->query($sql))trigger_error($db->error(),E_USER_ERROR);if($db->affected_rows()){$cat=vRegistry::parse($db->fetch_field('prop'));if(isset($cat[$k])){$a=new vCategory($k,0,$cat[$k][1],$cat[$k][2],$cat[$k][3],$cat[$k][4],isset($cat[$k][5])?$cat[$k][5]:0);if($v=='category')$s=vForm::select(array(0=>'')+ $a->select(),$e,'','','',(isset($d[$k])?$d[$k]:0),$y.$k);else if($v=='categories')$s=vForm::select($a->select(),$e.'[]','class="multiselect" size="10" multiple="multiple"','','',(isset($d[$k])?$d[$k]:0),$y.$k);else $s=vForm::radio($a->select(),$e,1,'','',(isset($d[$k])?$d[$k]:0),$y.$k);if(defined('V_CP'))$s.=' <a class="cp-button" href="'.VAR_INDEX.'?'.VAR_PAGE.'=cp.category&amp;'.VAR_SECTION.'='.$k.'&amp;'.VAR_RETURN.'='.$c.'"><span class="ico iedit" title="'.$tpl->l['EDIT'].'"></span></a>';}}break;case 'cfg':$s='<input type="hidden" name="'.$e.'" value="1" /><a href="'.VAR_INDEX.'?'.VAR_PAGE.'=cp.cfg&amp;'.VAR_TASK.'=edit&amp;'.VAR_ID.'='.$c.'"><span class="ico iedit"></span></a>';break;case 'ctype':$s=(isset($d['count'])&&$d['count'])?'<input type="text" id="'.$y.$k.'" name="'.$e.'" value="'.(($d[$k])?$d[$k]:'null').'" readonly />':vForm::select($ctype->r[$alt['page']=='cp.sitemap'?0:1],$e,'','name','name',isset($d[$k])?$d[$k]:null,$y.$k);break;case 'image':case 'media':case 'file':$s='';if(isset($d[$k])&&$d[$k]){$s.='<p>';switch(strtolower(substr(strrchr($d[$k],'.'),1))){case 'jpg':case 'jpeg':case 'gif':case 'png':case 'bmp':$s.='<img src="'.URL_UPLOAD.$d[$k].'" />';break;default:$s.='<a href="'.URL_UPLOAD.$d[$k].'">'.$d[$k].'</a>';break;}$s.=' <input type="hidden" id="'.$y.$k.'" name="'.$e.'" value="'.$d[$k].'" /><input type="checkbox" name="'.($f?$f.'['.$k.'_remover'.']':$k.'_remover').'" id="'.$y.$k.'_remover" value="1"><label for="'.$y.$k.'_remover">'.$tpl->l['REMOVE'].'</label></p>';}$s.='<input type="file" id="'.$y.$k.'_uploader" name="'.$y.$k.'_uploader" />'.(isset($tpl->l[strtoupper($k).'_NOTE'])?'<span class="note">'.$tpl->l[strtoupper($k).'_NOTE'].'</span>':'');if(defined('V_CP'))cpPage::help('upload');break;case 'images':case 'medias':case 'files':if(defined('V_CP')){if(!isset($cfg['~js']['file'])){vPage::head(URL_JS.'file/file.css','css');vPage::head(URL_JS.'file/upload.js','js');$cfg['~js']['file']=0;}$cfg['~js']['file']++;if(strpos($cfg['file']['dir'],'}'))$cfg['file']['dir']=strtr($cfg['file']['dir'],array('{ID}'=>$alt['module']['id'],'{ALIAS}'=>(($alt['module']['alias']=='/')?'0':$alt['module']['alias']),'{M}'=>date('m'),'{Y}'=>date('y'),'{YY}'=>date('Y')));$s='<div id="'.$y.$k.'_uploader">
	<div class="list"><table id="'.$k.'_dnd" class="form" style="width:auto;">';if(isset($d[$k])&&$d[$k]){if(!is_array($d[$k]))$d[$k]=explode("\n",$d[$k]);if(isset($d[$k.'_tit'])&&!is_array($d[$k.'_tit']))$d[$k.'_tit']=explode("\n",$d[$k.'_tit']);for($i=0,$j=sizeof($d[$k]);$i<$j;$i++){$t=in_array(strtolower(substr(strrchr($d[$k][$i],'.'),1)),array('jpg','gif','png','bmp','swf'));$s.=($d[$k][$i])?'<tr><td>'.(isset($p[$k.'_tit'])?'<input type="text" name="'.($f?$f.'['.$k.'_tit'.']':$k.'_tit').'['.$i.']" value="'.(isset($d[$k.'_tit'][$i])?$d[$k.'_tit'][$i]:'').'" /> &nbsp; ':'').'<input type="hidden" name="'.$e.'['.$i.']" value="'.$d[$k][$i].'"><a'.(($t)?' rel="'.$y.$k.$i.'" class="tooltip"':'').' href="'.URL_UPLOAD.$d[$k][$i].'" target="_blank">'.$d[$k][$i].'</a>'.(($t)?'<div id="'.$y.$k.$i.'" style="position:absolute;top:-9999px;">'.vForm::media($d[$k][$i]).'</div>':'').'</td><td><input type="checkbox" name="'.($f?$f.'['.$k.'_remover'.']':$k.'_remover').'['.$i.']" id="'.$y.$k.'_remover'.$i.'" value="1"><label for="'.$y.$k.'_remover'.$i.'"> '.$tpl->l['REMOVE'].'</label></td></tr>':'';}}$s.='</table></div>
<div><a class="button" href="javascript:;" id="'.$y.$k.'_uploader_picker">'.$tpl->l['UPLOAD'].'</a></div>
</div>
'.(isset($d[$k.'_tit'])?'<script type="text/javascript" src="'.URL_JS.'jquery.tablednd.js"></script>':'').'<script type="text/javascript">
'.(isset($d[$k.'_tit'])?'$(document).ready(function() {
    $("#'.$k.'_dnd").tableDnD();
});':'').'
var n_pos = 100;
var '.$y.$k.'_uploader = new plupload.Uploader({
	runtimes:"html5,flash,html4",
	browse_button:"'.$y.$k.'_uploader_picker",drop_element:"'.$y.$k.'_uploader",container:"'.$y.$k.'_uploader",
	url:"'.VAR_INDEX.'?'.VAR_PAGE.'=cp.fileman&'.VAR_TASK.'=upload&folder='.$cfg['file']['dir'].'/",
	max_file_size:"'.(isset($cfg['file']['size'])?intval($cfg['file']['size'])/ 1048576:1).'mb",
	chunk_size:"'.(isset($cfg['file']['chunk'])?intval($cfg['file']['chunk'])/ 1048576:1).'mb",
	flash_swf_url:"'.URL_JS.'file/flash.swf",
	filters:[{title:"Uploadable files",extensions:"'.$cfg['file']['image'].(($v=='medias'||$v=='files')?','.$cfg['file']['media']:'').($v=='files'?','.$cfg['file']['ext']:'').'"}],
	init:{
		FilesAdded:function(up, files){
			$.each(files, function(i, file) {
				$("#'.$y.$k.'_uploader .list table").append(\'<tr id="\' + file.id + \'"><td>'.(isset($p[$k.'_tit'])?'<input type="text" name="'.($f?$f.'['.$k.'_uploader_tit'.']':$k.'_uploader_tit').'[\' + n_pos + \']" value="" /> &nbsp; ':'').'\' + file.name + \' (\' + plupload.formatSize(file.size) + \')</td><td><span><a href="#" class="uploader-remove"></a></span></td></tr></div>\');
				n_pos++;
				if (file.status == plupload.FAILED) $("#" + file.id + " span").prepend(\'<a class="uploader-fail"></a> \');
				$("#"+file.id).find("a.uploader-remove").bind("click",function() {
					$("#"+file.id).remove();
					plupload.removeFile(file);
				});
			});
			hook_editform_submit("'.$y.$k.'_uploader.start();");
		},
		UploadProgress:function(up, file) {
			$("#"+file.id+" span").html(file.percent + "%");
		},
		FileUploaded:function(up, file, info) {
			$("#"+file.id+" span").html(\'<a class="uploader-done"></a>\');
			r = jQuery.parseJSON(info.response);
			if (r.error) {
				$("#"+file.id+" span").html(\'<a class="uploader-fail"></a> \'+r.error.message);
			}
			else {
				f = r.result || file.name;
				$("#" + file.id + " span").after(\'<input type="hidden" name="'.($f?$f.'['.$k.'_uploader'.']':$k.'_uploader').'[\' + n_pos + \']" value="'.$cfg['file']['dir'].'/\'+f+\'" />\');
				n_pos++;
			}
		},
		UploadComplete: function(up, files) {
			hook_editform_submit();
		}
	}
});
'.$y.$k.'_uploader.init();
</script>';cpPage::help('upload');$ignore=$k.'_tit';}else{$s.='<div class="'.$y.$k.'_wrp"><div id="'.$y.$k.'_uploader"><p><input type="file" name="'.$e.'_uploader[]" /></p>
</div><p><a href="javascript:'.$y.$k.'_add();">'.$tpl->_('ADD_FILE').'</a></p>'.(isset($tpl->l[strtoupper($k).'_NOTE'])?'<p class="note">'.$tpl->l[strtoupper($k).'_NOTE'].'</p>':'').'</div><script type="text/javascript">
function '.$y.$k.'_add() {
$("#'.$y.$k.'_uploader").append(\'<p><input type="file" name="'.$e.'_uploader[]" /></p>\');
'.$y.$k.'_i++;
}
</script>';}break;case 'html':case 'htm':case 'text':case 'tinytext':case 'code':$x='editor'.(($v=='html')?(($f)?'_tiny':''):(($f||$v=='tinytext')?'_text':'_preview'));$s='<textarea id="'.$y.$k.'" name="'.$e.'" class="'.$x.'">'.(isset($d[$k])?$d[$k]:'').'</textarea>';if($cfg['langs']>1&&$r){$s='<p class="combine">'.$s.'<span class="lang i'.$cfg['lang'].'" title="'.$cfg['language'][$cfg['lang']][1].'"></span></p>';foreach($cfg['language'] as $a=>$b){$e=$a.(($f)?'['.$f.']':'').'['.$k.']';if($a<>$cfg['lang'])$s.='<p class="combine"><textarea id="'.$a.'_'.$y.$k.'" name="'.$e.'" class="'.$x.'">'.(isset($d['_'][$a][$k])?$d['_'][$a][$k]:'').'</textarea><span class="lang i'.$a.'" title="'.$b[1].'"></span></p>';}}break;case 'meta':$g=1;$b=isset($d['meta'])?vRegistry::parse($d['meta']):null;if($cfg['langs']>1&&$r){foreach($cfg['language'] as $i=>$j){if($i<>$cfg['lang']&&isset($d['_'][$i]))$b['_'][$i]=vRegistry::parse($d['_'][$i]['meta']);}}$s=vForm::draw(array('t','k'=>'text','d'=>'text'),$b,($cfg['langs']>1&&$r)?array('t','k','d'):null,null,$c,'meta');if(defined('V_CP'))cpPage::help('meta');break;case 'page':$s=vForm::select($map->select(isset($d['id'])?$d['id']:0,''),$e,'','','',(isset($d[$k])?$d[$k]:0),$y.$k);break;case 'pages':if(!isset($d[$k])||!$d[$k])$d[$k]=array_keys($map->select());else if(is_string($d[$k]))$d[$k]=explode(',',$d[$k]);$s=vForm::select($map->select(),$e.'[]','class="multiselect" size="10" multiple="multiple"','','',$d[$k],$y.$k);break;case 'prop':$g=1;if($c){$tpl->lang($c);$b=null;if($alt['page']=='cp.sitemap'&&isset($ctype->r[0][$d['ctype']])){$b=$ctype->r[0][$d['ctype']]['prop'];}else if($alt['page']=='cp.blocks'&&isset($ctype->r[1][$d['ctype']])){$b=$ctype->r[1][$d['ctype']]['prop'];}if($cfg['langs']==1)unset($b['lan']);$s=vForm::draw($b,vRegistry::parse($d['prop']),'',null,$c,'prop');vPage::head('<script type="text/javascript">$(function(){
$("select.multiselect").multiSelect({selectAll: true, selectAllText: \''.$tpl->l['ALL'].'\', noneSelected: \''.$tpl->l['ALL'].'\', oneOrMoreSelected: \'% '.$tpl->l['PAGE'].'\'});
if($(\'#prop\').html()){$(\'#prop\').show()}else{$(\'#prop\').hide()}
$(\'#ctype\').change(function(){
	$.get(\''.VAR_INDEX.'?'.VAR_PAGE.'='.$alt['page'].'&'.VAR_TASK.'=prop&ctype='.'\' + $(\'#ctype\').val(), function(data) {
		$(\'#prop\').html(data);
		if(data){$(\'#prop\').show()}else{$(\'#prop\').hide()}
		$("select.multiselect").multiSelect({selectAll: true, selectAllText: \''.$tpl->l['ALL'].'\', noneSelected: \''.$tpl->l['ALL'].'\', oneOrMoreSelected: \'% '.$tpl->l['PAGE'].'\'});
	});
});})</script>');if(sizeof($p)>1)$s.='</table><table class="form">';}else{$b=isset($d['prop'])?vRegistry::parse($d['prop']):null;if($cfg['langs']>1&&$r){foreach($cfg['language'] as $i=>$j){if($i<>$cfg['lang']&&isset($d['_'][$i]))$b['_'][$i]=vRegistry::parse($d['_'][$i]['prop']);}}$o=(isset($alt['module']['prop']['ext'])&&$alt['module']['prop']['ext'])?$alt['module']['prop']['ext']:$alt['module']['prop'];$s=vForm::draw($o,$b,($cfg['langs']>1&&$r)?array_keys($o):null,null,'','prop');}break;case 'record':case 'records':if($c){$sql='SELECT id, title FROM #__'.$c;if(!$db->query($sql))trigger_error($db->error(),E_USER_ERROR);$s=vForm::select($db->fetch(),$e,'','id','title',(isset($d[$k])?$d[$k]:0),$y.$k);$s.=' <a class="cp-button" href="'.VAR_INDEX.'?'.VAR_PAGE.'=cp.'.$c.'"><span class="ico iedit" title="'.$tpl->l['EDIT'].'"></span></a>';}break;case 'size':$s='<input type="text" id="'.$y.$k.'" name="'.$e.'[0]" value="'.(isset($d[$k])?$d[$k][0]:'').'" class="'.$y.'int" title="'.$tpl->l['WIDTH'].'" />';$s.='<span> x </span><input type="text" id="'.$y.$k.'1" name="'.$e.'[1]" value="'.(isset($d[$k])?$d[$k][1]:'').'" class="'.$y.'int" title="'.$tpl->l['HEIGHT'].'" /> <label>(pixel)</label>';break;case 'tpl':$s='';$m=(($alt['page']=='cp.blocks')?'blk_':'').$c;if($t=glob(PATH_THEME.DS.$m.'*.tpl.php')){$j=strlen(PATH_THEME.DS);foreach($t as $i){$i=substr($i,$j,-8);if($i!==$m)$s.='<option value="'.$i.'"'.((isset($d[$k])&&$d[$k]==$i)?' selected="selected"':'').'>'.$i.'</option>';}if($s)$s='<select name="'.$e.'" id="'.$y.$k.'"><option value=""> </option>'.$s.'</select>';}break;case is_array($v):if(isset($tpl->l[strtoupper($y.$k.'_'.$v[0])])||isset($tpl->l[strtoupper($y.$k.'_'.$v[1])])){$t=array();foreach($v as $b)$t[$b]=isset($tpl->l[strtoupper($y.$k.'_'.$b)])?$tpl->l[strtoupper($y.$k.'_'.$b)]:$b;$s=vForm::select($t,$e,'',null,null,(isset($d[$k])?$d[$k]:''),$y.$k);}else $s=vForm::select($v,$e,'',true,null,(isset($d[$k])?$d[$k]:''),$y.$k);break;default:if(isset($d[$k])&&strpos($d[$k],'>')){$s=$d[$k];}else{$s='<input type="text" id="'.$y.$k.'" name="'.$e.'" value="'.(isset($d[$k])?$d[$k]:'').'" class="'.(($k=='title')?'focus ':'').$y.$v.'" />';if($cfg['langs']>1&&$r){$s='<p class="combine">'.$s.'<span class="lang i'.$cfg['lang'].'" title="'.$cfg['language'][$cfg['lang']][1].'"></span></p>';foreach($cfg['language'] as $a=>$b){$e=$a.(($f)?'['.$f.']':'').'['.$k.']';if($a<>$cfg['lang'])$s.='<p class="combine"><input type="text" id="'.$a.'_'.$y.$k.'" name="'.$e.'" value="'.(isset($d['_'][$a][$k])?$d['_'][$a][$k]:'').'" class="'.$y.$v.'" /><span class="lang i'.$a.'" title="'.$b[1].'"></span></p>';}}}}if($s){$i=$y.$k;$t=strtoupper($k);if($y){$y=strtoupper($y);if(isset($tpl->l[$y.$t]))$t=$y.$t;}$t=(isset($tpl->l[$t]))?$tpl->l[$t]:ucfirst($k);if($z)$h=substr($h,0,-10).'<label style="margin-left:10px;" for="'.$i.'">'.(in_array($k,$n)?'<span class="ico inn" title="'.$tpl->_('NOTNULL').'"></span>':'').$t.'</label> '.$s.'</td></tr>';else $h.=($g)?$s:'<tr><th><label for="'.$i.'">'.(in_array($k,$n)?'<span class="ico inn" title="'.$tpl->_('NOTNULL').'"></span>':'').$t.'</label></th><td>'.$s.'</td></tr>';}}}}return $h;}}