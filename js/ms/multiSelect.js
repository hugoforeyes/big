/* jQuery multiSelect, 1.2.2 beta, Cory S.N. LaViska http://abeautifulsite.net */
if(jQuery)(function($){function renderOption(a,b){var c='<label><input type="checkbox" name="'+a+'" value="'+b.value+'"';if(b.selected){c+=' checked="checked"'}c+=' />'+b.text+'</label>';return c}function renderOptions(a,b,o){var c="";for(var i=0;i<b.length;i++){if(b[i].optgroup){c+='<label class="optGroup">';if(o.optGroupSelectable){c+='<input type="checkbox" class="optGroup" />'+b[i].optgroup}else{c+=b[i].optgroup}c+='</label><div class="optGroupContainer">';c+=renderOptions(a,b[i].options,o);c+='</div>'}else{c+=renderOption(a,b[i])}}return c}function buildOptions(k){var l=$(this);var m=l.next('.multiSelectOptions');var o=l.data("config");var n=l.data("callback");m.html("");var p="";if(o.selectAll){p+='<label class="selectAll"><input type="checkbox" class="selectAll" />'+o.selectAllText+'</label>'}p+=renderOptions(l.attr('rel'),k,o);m.html(p);var q=m.width();var r=false;if(m.height()>o.listHeight){m.css("height",o.listHeight+'px');r=true}else{m.css("height",'')}var s=r&&(q==m.width())?17:0;if((m.width()+s)<l.outerWidth()){m.css("width",l.outerWidth()-2+'px')}else{m.css("width",(m.width()+s)+'px')}if($.fn.bgiframe)l.next('.multiSelectOptions').bgiframe({width:m.width(),height:m.height()});if(o.selectAll){m.find('INPUT.selectAll').click(function(){if($(this).parent().hasClass("checked")){m.find('INPUT:checkbox').attr('checked',false).parent("LABEL").removeClass("checked")}else{m.find('INPUT:checkbox').attr('checked',true).parent("LABEL").addClass("checked")}})}if(o.optGroupSelectable){m.addClass('optGroupHasCheckboxes');m.find('INPUT.optGroup').click(function(){$(this).parent().next().find('INPUT:checkbox').attr('checked',$(this).attr('checked')).parent("LABEL").toggleClass('checked',$(this).attr('checked'))})}m.find('INPUT:checkbox').click(function(){$(this).parent("LABEL").toggleClass('checked',$(this).attr('checked'));updateSelected.call(l);l.focus();if($(this).parent().parent().hasClass('optGroupContainer')){updateOptGroup.call(l,$(this).parent().parent().prev())}if(n){n($(this))}});m.each(function(){$(this).find('INPUT:checked').parent().addClass('checked')});updateSelected.call(l);if(o.optGroupSelectable){m.find('LABEL.optGroup').each(function(){updateOptGroup.call(l,$(this))})}m.find('LABEL:has(INPUT)').hover(function(){$(this).parent().find('LABEL').removeClass('hover');$(this).addClass('hover')},function(){$(this).parent().find('LABEL').removeClass('hover')});l.keydown(function(e){var b=$(this).next('.multiSelectOptions');if(b.css('visibility')!='hidden'){if(e.keyCode==9){$(this).addClass('focus').trigger('click');$(this).focus().next(':input').focus();return true}if(e.keyCode==27||e.keyCode==37||e.keyCode==39){$(this).addClass('focus').trigger('click')}if(e.keyCode==40||e.keyCode==38){var c=b.find('LABEL');var d=c.index(c.filter('.hover'));var f=-1;if(d<0){b.find('LABEL:first').addClass('hover')}else if(e.keyCode==40&&d<c.length-1){f=d+1}else if(e.keyCode==38&&d>0){f=d-1}if(f>=0){$(c.get(d)).removeClass('hover');$(c.get(f)).addClass('hover');adjustViewPort(b)}return false}if(e.keyCode==13||e.keyCode==32){var g=b.find('LABEL.hover INPUT:checkbox');g.attr('checked',!g.attr('checked')).parent("LABEL").toggleClass('checked',g.attr('checked'));if(g.hasClass("selectAll")){b.find('INPUT:checkbox').attr('checked',g.attr('checked')).parent("LABEL").addClass('checked').toggleClass('checked',g.attr('checked'))}updateSelected.call(l);if(n)n($(this));return false}if(e.keyCode>=33&&e.keyCode<=126){var h=b.find('LABEL:startsWith('+String.fromCharCode(e.keyCode)+')');var i=h.index(h.filter('LABEL.hover'));var j=h.filter(function(a){return a>i});h=(j.length>=1?j:h).filter("LABEL:first");if(h.length==1){b.find('LABEL.hover').removeClass('hover');h.addClass('hover');adjustViewPort(b)}}}else{if(e.keyCode==38||e.keyCode==40||e.keyCode==13||e.keyCode==32){$(this).removeClass('focus').trigger('click');b.find('LABEL:first').addClass('hover');return false}if(e.keyCode==9){b.next(':input').focus();return true}}if(e.keyCode==13)return false})}function adjustViewPort(a){var b=a.find('LABEL.hover').position().top+a.find('LABEL.hover').outerHeight();if(b>a.innerHeight()){a.scrollTop(a.scrollTop()+b-a.innerHeight())}if(a.find('LABEL.hover').position().top<0){a.scrollTop(a.scrollTop()+a.find('LABEL.hover').position().top)}}function updateOptGroup(a){var b=$(this);var o=b.data("config");if(o.optGroupSelectable){var c=true;$(a).next().find('INPUT:checkbox').each(function(){if(!$(this).attr('checked')){c=false;return false}});$(a).find('INPUT.optGroup').attr('checked',c).parent("LABEL").toggleClass('checked',c)}}function updateSelected(){var a=$(this);var b=a.next('.multiSelectOptions');var o=a.data("config");var i=0;var c=true;var d='';b.find('INPUT:checkbox').not('.selectAll, .optGroup').each(function(){if($(this).attr('checked')){i++;d=d+$(this).parent().text()+', '}else c=false});d=d.replace(/\s*\,\s*$/,'');if(i==0){a.find("span").html(o.noneSelected)}else{if(o.oneOrMoreSelected=='*'){a.find("span").html(d);a.attr("title",d)}else{a.find("span").html(o.oneOrMoreSelected.replace('%',i))}}if(o.selectAll){b.find('INPUT.selectAll').attr('checked',c).parent("LABEL").toggleClass('checked',c)}}$.extend($.fn,{multiSelect:function(o,i){if(!o)o={};if(o.selectAll==undefined)o.selectAll=true;if(o.selectAllText==undefined)o.selectAllText="Select All";if(o.noneSelected==undefined)o.noneSelected='Select options';if(o.oneOrMoreSelected==undefined)o.oneOrMoreSelected='% selected';if(o.optGroupSelectable==undefined)o.optGroupSelectable=false;if(o.listHeight==undefined)o.listHeight=150;$(this).each(function(){var b=$(this);var c='<a href="javascript:;" class="multiSelect"><span></span></a>';c+='<div class="multiSelectOptions" style="position: absolute; z-index: 99999; visibility: hidden;"></div>';$(b).after(c);var d=$(b).next('.multiSelect');var e=d.next('.multiSelectOptions');d.find("span").css("width",$(b).width()+'px');d.data("config",o);d.data("callback",i);var f=[];$(b).children().each(function(){if(this.tagName.toUpperCase()=='OPTGROUP'){var a=[];f.push({optgroup:$(this).attr('label'),options:a});$(this).children('OPTION').each(function(){if($(this).val()!=''){a.push({text:$(this).html(),value:$(this).val(),selected:$(this).attr('selected')})}})}else if(this.tagName.toUpperCase()=='OPTION'){if($(this).val()!=''){f.push({text:$(this).html(),value:$(this).val(),selected:$(this).attr('selected')})}}});$(b).remove();d.attr("rel",$(b).attr("name"));d.attr("id",$(b).attr("id"));buildOptions.call(d,f);var g=0;select_size=$(this).attr("size")?$(this).attr("size"):0;if(select_size>1){d.addClass("showsize");d.multiSelectOptionsShow();if(o.selectAll){for(var h=0;h<=select_size;h++){g+=d.next().children("label:eq(1)").outerHeight()}}else{for(var h=1;h<=select_size;h++){g+=d.next().children("label").outerHeight()}}d.next().css({position:"relative",visibility:"visible","z-index":1,top:0,height:g+1})};d.not(".showsize").hover(function(){$(this).addClass('hover')},function(){$(this).removeClass('hover')}).click(function(){if($(this).hasClass('active')){$(this).multiSelectOptionsHide()}else{$(this).multiSelectOptionsShow()}return false}).focus(function(){$(this).addClass('focus')}).blur(function(){$(this).removeClass('focus')});$(document).click(function(a){if(!($(a.target).parents().andSelf().is('.multiSelectOptions'))){d.not(".showsize").multiSelectOptionsHide()}})})},multiSelectOptionsUpdate:function(a){buildOptions.call($(this),a)},multiSelectOptionsHide:function(){$(this).removeClass('active').removeClass('hover').next('.multiSelectOptions').css('visibility','hidden')},multiSelectOptionsShow:function(){var a=$(this);var b=a.next('.multiSelectOptions');var o=a.data("config");$('.multiSelect').not(".showsize").multiSelectOptionsHide();b.find('LABEL').removeClass('hover');a.addClass('active').next('.multiSelectOptions').css('visibility','visible');a.focus();a.next('.multiSelectOptions').scrollTop(0);var c=a.position();if(select_size<=1){a.next('.multiSelectOptions').css({top:c.top+$(this).outerHeight()+'px'});a.next('.multiSelectOptions').css({left:c.left+'px'})}},selectedValuesString:function(){var a="";$(this).next('.multiSelectOptions').find('INPUT:checkbox:checked').not('.optGroup, .selectAll').each(function(){a+=$(this).attr('value')+","});return a.replace(/\s*\,\s*$/,'')}});$.expr[":"].startsWith=function(a,i,m){var b=m[3];if(!b)return false;return eval("/^[/s]*"+b+"/i").test($(a).text())}})(jQuery);